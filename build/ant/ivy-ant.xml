<?xml version="1.0" encoding="UTF-8"?>

<project name="ivy" default="ivy.fail" xmlns:ivy="antlib:org.apache.ivy.ant">

    <description>ivy tasks</description>

    <target name="ivy.fail">
        <fail message="Do not execute this file directly.  Use build.xml from project root" />
    </target>

    <property name="ivy.report.dir" value="${report.dir}/ivy" />

    <target name="ivy.init" depends="common.init" unless="alrady.ivy.init" description="resolves dependencies into your ivy cache - only needs to be run upon initial checkout or when your ivy.xml changes">
		<property name="alrady.ivy.init" value="true" />

    	<ivy:resolve validate="true"/>

    	<ivy:cachepath pathid="classpath.compile.ivy" conf="compile, tomcat"/>

      	<ivy:cachepath pathid="classpath.ant.ivy" conf="ant"/>

    	<!-- build compile classpath -->
    	<path id="classpath.compile">
    		<path refid="classpath.compile.ivy"/>
    	</path>

    	<!-- build ant classpath -->
    	<path id="classpath.ant">
    		<path refid="classpath.ant.ivy"/>
    	</path>
    </target>

    <target name="ivy.clean" depends="common.init" description="clears the ivy cache">
    	<ivy:cleancache />
    </target>

    <target name="ivy.report" depends="ivy.init" description="gens a report on dependencies">
        <delete dir="${ivy.report.dir}" />
        <mkdir dir="${ivy.report.dir}" />

   		<ivy:report todir="${ivy.report.dir}" />

        <ivy:retrieve
                pattern="${ivy.report.dir}/lib/[conf]/[artifact]-[revision](-[classifier]).[ext]" />
    </target>

</project>
